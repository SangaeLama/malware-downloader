#! /bin/bash
#date : 2022/11/09
#author: Sangay Lama
#This script is designed to help you download malwares from Malware Bazaar.
#version 1.1
echo -e "
                 .__                                          .___                         .__                       .___
  _____  _____   |  |  __  _  _______   _______   ____      __| _/  ____  __  _  __  ____  |  |    ____  _____     __| _/  ____  _______
 /     \ \__  \  |  |  \ \/ \/ /\__  \  \_  __ \_/ __ \    / __ |  /  _ \ \ \/ \/ / /    \ |  |   /  _ \ \__  \   / __ | _/ __ \ \_  __ \\
|  Y Y  \ / __ \_|  |__ \     /  / __ \_ |  | \/\  ___/   / /_/ | (  <_> ) \     / |   |  \|  |__(  <_> ) / __ \_/ /_/ | \  ___/  |  | \/
|__|_|  /(____  /|____/  \/\_/  (____  / |__|    \___  >  \____ |  \____/   \/\_/  |___|  /|____/ \____/ (____  /\____ |  \___  > |__|
      \/      \/                     \/              \/        \/                       \/                    \/      \/      \/
      "

nline="========================================================================="
echo -e "This is Malware Downloader, lets download some malwares. Select how you want to download the malware."
echo -e "\n\t1. by File Type (Default) \n\t2. by File Tag -- available in Malware Bazaar\n\t3. by File Hash -- SHA256\n"
read -p "Your selection:    " option

case $option in
    1)
        echo -e "\nSelected \t>> \t1.by File Type. \n\nPlease enter the type/extension of the malware you would like to download.\nE.g. exe, rar, doc, docx etc."
        read file_type
        echo -e "\nYou selected .$file_type as file type, now please type the number of samples to download:"
        read limit
        echo -e "\n$nline\n"
        echo -e "\n OK! $limit samples of malwares with .$file_type extension will be downloaded.\n"

        echo -e "\n Created MalwareDownloads folder.\n Getting malware info, this may take some time. Have patience.\n"
        mkdir ./MalwareDownloads
        mkdir ./MalwareDownloads/$file_type-$limit/ #making a folder for downloading the malwares

        #getting the info of the malwares specified in a json format
        wget --post-data "query=get_file_type&file_type=$file_type&limit=$limit" https://mb-api.abuse.ch/api/v1/ -O ./MalwareDownloads/$file_type-$limit/$file_type-$limit.json

        #the json contains many information about the malwares, we just need their SHA256 hash, jq is the perfect tool for that.
        jq -r '.data[].sha256_hash' ./MalwareDownloads/$file_type-$limit/$file_type-$limit.json | while read i; do
            #looping to download malware from each hash from the jq output
            wget --post-data "query=get_file&sha256_hash=$i" https://mb-api.abuse.ch/api/v1/ -O ./MalwareDownloads/$file_type-$limit/$i
        done
    ;;
    2)
        echo -e "\nPlease enter the MalwareBazar Tag of the malware you want to download (Case-sensitive).\nE.g. Trickbot, emotet, elf etc.\n"
        read file_tag
        echo "You entered $file_tag tag, now please type the number of samples to download:"
        read limit
        echo -e "\n$nline\n"
        echo -e "\n OK! $limit samples of malwares with .$file_tag tags will be downloaded.\n"

        echo -e "\n Created MalwareDownloads folder.\n Getting malware info, this may take some time. Have patience.\n"
        mkdir ./MalwareDownloads/$file_tag-$limit/ #making a folder for downloading the malwares

        #getting the info of the malwares specified in a json format
        wget --post-data "query=get_taginfo&tag=$file_tag&limit=$limit" https://mb-api.abuse.ch/api/v1/ -O ./MalwareDownloads/$file_tag-$limit/$file_tag-$limit.json

        #the json contains many information about the malwares, we just need their SHA256 hash, jq is the perfect tool for that.
        jq -r '.data[].sha256_hash' ./MalwareDownloads/$file_tag-$limit/$file_tag-$limit.json | while read i; do
            #looping to download malware from each hash from the jq output
            wget --post-data "query=get_file&sha256_hash=$i" https://mb-api.abuse.ch/api/v1/ -O ./MalwareDownloads/$file_tag-$limit/$i
        done
    ;;
    3)
        echo -e "Please enter the SHA256 hash of the malware you want to download.\n\t"
        read file_hash
        echo -e "\n"
        #downloading a malware based on its sha256 hash
        wget --post-data "query=get_file&sha256_hash=$file_hash" https://mb-api.abuse.ch/api/v1/ -O ./MalwareDownloads/$file_hash
    ;;
    *)
        echo -e "\n\t Invalid Input. QUITTING..."
    ;;
esac
